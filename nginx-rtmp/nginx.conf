worker_processes auto;
rtmp_auto_push on;
events {
    worker_connections 1024;
}

# RTMP configuration
rtmp {
    server {
        listen 1936;
        chunk_size 4096;
        
        application live {
            live on;
            record off;
            
            # Allow publishing from docker network
            allow publish all;
            
            # Allow playing from anywhere
            allow play all;
            
            # Disable authentication for now
            # on_publish http://auth-service/auth;
        }
    }
}

# HTTP configuration for stats
http {
    server {
        listen 8080;
        
        location /stat {
            rtmp_stat all;
            rtmp_stat_stylesheet stat.xsl;
        }
        
        location /stat.xsl {
            root /usr/share/nginx/html;
        }
        
        location /health {
            access_log off;
            return 200 "OK\n";
            add_header Content-Type text/plain;
        }
    }
}